<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Last-Modified" content="0">
    <meta http-equiv="ETag" content="0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https: data: blob:; img-src 'self' https: data: blob: *; connect-src 'self' https: *;">
    <title>老非FS资料库</title>
    <link rel="stylesheet" href="styles.css?v=202510038901">
    <!-- 使用本地图标字体，避免CDN问题 -->
    <!-- 使用国内CDN，提高访问速度 -->
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- Service Worker 注册 -->
    <script>
        // 检查是否支持Service Worker且不在file://协议下
        if ('serviceWorker' in navigator && location.protocol !== 'file:') {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js?v=202510038901')
                    .then((registration) => {
                        console.log('Service Worker registered with scope:', registration.scope);
                        // 安全的调试信息调用
                        if (typeof addDebugInfo === 'function') {
                            addDebugInfo('Service Worker注册成功: ' + registration.scope);
                        }
                        
                        // 检查更新
                        registration.addEventListener('updatefound', () => {
                            console.log('Service Worker update found');
                            if (typeof addDebugInfo === 'function') {
                                addDebugInfo('Service Worker发现更新');
                            }
                        });
                        
                        // 监听控制器变化
                        navigator.serviceWorker.addEventListener('controllerchange', () => {
                            console.log('Service Worker controller changed');
                            if (typeof addDebugInfo === 'function') {
                                addDebugInfo('Service Worker控制器已更新');
                            }
                        });
                    })
                    .catch((error) => {
                        console.log('Service Worker registration failed:', error);
                        if (typeof addDebugInfo === 'function') {
                            addDebugInfo('Service Worker注册失败: ' + error.message);
                        }
                    });
            });
        } else {
            if (location.protocol === 'file:') {
                console.log('本地文件模式，跳过Service Worker注册');
                if (typeof addDebugInfo === 'function') {
                    addDebugInfo('本地文件模式，跳过Service Worker注册');
                }
            } else {
                console.log('浏览器不支持Service Worker');
            if (typeof addDebugInfo === 'function') {
                addDebugInfo('浏览器不支持Service Worker');
                }
            }
        }
    </script>
</head>
<body>
    <!-- 头部区域 -->
    <header class="header">
        <div class="header-content">
            <h1 class="main-title">街头篮球资料库</h1>
            <div class="title-underline"></div>
            <div class="header-bottom">
                <p class="powered-by">Powered by 老非</p>
                <div class="contact-tag">
                    <i class="fas fa-comments"></i>
                    <span>laofei90186</span>
                </div>
            </div>
            
            <!-- 调试信息 -->
            <div id="debug-info" style="background: rgba(0,0,0,0.8); color: white; padding: 10px; margin: 10px; border-radius: 5px; font-size: 12px; display: none;">
                <div id="debug-content">调试信息加载中...</div>
                <div style="margin-top: 5px;">
                    <button onclick="toggleDebug()" style="background: #007bff; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin-right: 5px;">切换调试</button>
                    <button onclick="checkCacheStatus()" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin-right: 5px;">检查缓存</button>
                    <button onclick="clearAllCaches()" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px;">清除缓存</button>
                </div>
            </div>
            

            

        </div>
    </header>

    <!-- 移动端导航栏 -->
    <nav class="mobile-nav">
        <div class="mobile-nav-menu active" id="mobile-nav-menu">
            <button class="mobile-nav-item active" data-section="home">
                <i class="fas fa-home"></i>
                <span>首页</span>
            </button>
            <button class="mobile-nav-item has-submenu" data-parent="strategy">
                <i class="fas fa-book"></i>
                <span>超特攻略</span>
                <i class="fas fa-chevron-right submenu-arrow"></i>
            </button>
            <button class="mobile-nav-item has-submenu" data-parent="props">
                <i class="fas fa-box"></i>
                <span>FS道具</span>
                <i class="fas fa-chevron-right submenu-arrow"></i>
            </button>
            <button class="mobile-nav-item" data-section="images">
                <i class="fas fa-graduation-cap"></i>
                <span>老非教程</span>
            </button>
            <button class="mobile-nav-item" data-section="computer-config">
                <i class="fas fa-desktop"></i>
                <span>电脑配置</span>
            </button>
            <button class="mobile-nav-item" data-section="club">
                <i class="fas fa-users"></i>
                <span>俱乐部</span>
            </button>
            <button class="mobile-nav-item" data-section="events">
                <i class="fas fa-calendar-alt"></i>
                <span>最新活动</span>
            </button>
        </div>
        <!-- 二级导航菜单 -->
        <div class="mobile-submenu" id="strategy-submenu">
            <button class="mobile-submenu-back" onclick="closeSubmenu()">
                <i class="fas fa-chevron-left"></i>
                <span>返回</span>
            </button>
            <h3>超特攻略</h3>
            <button class="mobile-nav-item" data-section="gallery">
                <i class="fas fa-images"></i>
                <span>超特图鉴</span>
            </button>
            <button class="mobile-nav-item" data-section="characters">
                <i class="fas fa-running"></i>
                <span>超特动作</span>
            </button>
            <button class="mobile-nav-item" data-section="ranking">
                <i class="fas fa-trophy"></i>
                <span>职业排名</span>
            </button>
            <button class="mobile-nav-item" data-section="comparison">
                <i class="fas fa-balance-scale"></i>
                <span>超特对比</span>
            </button>
        </div>
        <div class="mobile-submenu" id="props-submenu">
            <button class="mobile-submenu-back" onclick="closeSubmenu()">
                <i class="fas fa-chevron-left"></i>
                <span>返回</span>
            </button>
            <h3>FS道具</h3>
            <button class="mobile-nav-item" data-section="account-recommend">
                <i class="fas fa-star"></i>
                <span>职业&粉丝套</span>
            </button>
            <button class="mobile-nav-item" data-section="fs-single">
                <i class="fas fa-font"></i>
                <span>FS单字</span>
            </button>
        </div>
    </nav>

    <!-- 主要内容区域 -->
    <main class="main-content">
        <!-- 主导航按钮 -->
        <div class="nav-container">
            <div class="nav-buttons">
                <button class="nav-btn active" data-section="home">
                    <i class="fas fa-home"></i>
                    <span>首页</span>
                </button>
                <button class="nav-btn" data-parent="strategy">
                    <i class="fas fa-book"></i>
                    <span>超特攻略</span>
                </button>
                <button class="nav-btn" data-parent="props">
                    <i class="fas fa-box"></i>
                    <span>FS道具</span>
                </button>
                <button class="nav-btn" data-section="images">
                    <i class="fas fa-graduation-cap"></i>
                    <span>老非教程</span>
                </button>
                <button class="nav-btn" data-section="computer-config">
                    <i class="fas fa-desktop"></i>
                    <span>电脑配置</span>
                </button>
                <button class="nav-btn" data-section="club">
                    <i class="fas fa-users"></i>
                    <span>俱乐部</span>
                </button>
                <button class="nav-btn" data-section="events">
                    <i class="fas fa-calendar-alt"></i>
                    <span>最新活动</span>
                </button>
            </div>
        </div>
        
        <!-- 二级导航菜单容器 -->
        <div class="subnav-container" id="subnav-container">
            <!-- 超特攻略子菜单 -->
            <div class="subnav-menu" id="strategy-subnav">
                <button class="subnav-btn" data-section="gallery">
                    <i class="fas fa-images"></i>
                    <span>超特图鉴</span>
                </button>
                <button class="subnav-btn" data-section="characters">
                    <i class="fas fa-running"></i>
                    <span>超特动作</span>
                </button>
                <button class="subnav-btn" data-section="ranking">
                    <i class="fas fa-trophy"></i>
                    <span>职业排名</span>
                </button>
                <button class="subnav-btn" data-section="comparison">
                    <i class="fas fa-balance-scale"></i>
                    <span>超特对比</span>
                </button>
            </div>
            <!-- FS道具子菜单 -->
            <div class="subnav-menu" id="props-subnav">
                <button class="subnav-btn" data-section="account-recommend">
                    <i class="fas fa-star"></i>
                    <span>职业&粉丝套</span>
                </button>
                <button class="subnav-btn" data-section="fs-single">
                    <i class="fas fa-font"></i>
                    <span>FS单字</span>
                </button>
            </div>
        </div>

        <!-- 角色代次筛选按钮 -->
        <div class="filter-container">
            <div class="filter-buttons">
                <button class="filter-btn" data-generation="1">
                    <i class="fas fa-bolt"></i>
                    <span>1代超特</span>
                </button>
                <button class="filter-btn" data-generation="2">
                    <i class="fas fa-bolt"></i>
                    <span>2代超特</span>
                </button>
                <button class="filter-btn" data-generation="3">
                    <i class="fas fa-bolt"></i>
                    <span>3代超特</span>
                </button>
                <button class="filter-btn" data-generation="3_5">
                    <i class="fas fa-bolt"></i>
                    <span>3.5代超特</span>
                </button>
                <button class="filter-btn" data-generation="4">
                    <i class="fas fa-bolt"></i>
                    <span>4代超特</span>
                </button>
                <button class="filter-btn" data-generation="4_5">
                    <i class="fas fa-bolt"></i>
                    <span>4.5代超特</span>
                </button>
                <button class="filter-btn" data-generation="5">
                    <i class="fas fa-bolt"></i>
                    <span>5代超特</span>
                </button>
                <button class="filter-btn" data-generation="6">
                    <i class="fas fa-bolt"></i>
                    <span>6代超特</span>
                </button>
                <button class="filter-btn" data-generation="6_5">
                    <i class="fas fa-bolt"></i>
                    <span>6.5代超特</span>
                </button>
                <button class="filter-btn" data-generation="7">
                    <i class="fas fa-bolt"></i>
                    <span>7代超特</span>
                </button>
                <button class="filter-btn" data-generation="7_5">
                    <i class="fas fa-bolt"></i>
                    <span>7.5代超特</span>
                </button>
                <button class="filter-btn" data-generation="8">
                    <i class="fas fa-bolt"></i>
                    <span>8代超特</span>
                </button>
                <button class="filter-btn active" data-generation="9">
                    <i class="fas fa-bolt"></i>
                    <span>9代超特</span>
                </button>
            </div>
        </div>

        <!-- 首页介绍区域 -->
        <div id="home-section" class="content-section active">
            <div class="home-container">
                <div class="home-hero">
                    <h2 class="home-title">老非FS资料库</h2>
                    <p class="home-subtitle">专业街头篮球超特角色资料平台</p>
                </div>
                
                <div class="home-features">
                    <div class="feature-card" onclick="switchToSection('gallery')">
                        <div class="feature-icon">
                            <i class="fas fa-images"></i>
                        </div>
                        <h3>超特图鉴</h3>
                    </div>
                    
                    <div class="feature-card" onclick="switchToSection('characters')">
                        <div class="feature-icon">
                            <i class="fas fa-running"></i>
                        </div>
                        <h3>超特动作</h3>
                    </div>
                    
                     <div class="feature-card" onclick="switchToSection('ranking')">
                         <div class="feature-icon">
                             <i class="fas fa-trophy"></i>
                         </div>
                         <h3>职业排名</h3>
                     </div>
                     
                     <div class="feature-card" onclick="switchToSection('comparison')">
                         <div class="feature-icon">
                             <i class="fas fa-balance-scale"></i>
                         </div>
                         <h3>超特对比</h3>
                     </div>
                    
                    <div class="feature-card" onclick="switchToSection('account-recommend')">
                        <div class="feature-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <h3>职业&粉丝套</h3>
                    </div>
                    
                    <div class="feature-card" onclick="switchToSection('images')">
                        <div class="feature-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <h3>老非课程</h3>
                    </div>
                </div>
                
                
            </div>
        </div>

        <!-- 内容显示区域 -->
        <div class="content-area">
            <div id="gallery-section" class="content-section">
                <h2>超特图鉴</h2>
                <div class="gallery-grid" id="gallery-grid">
                    <!-- 图鉴卡片将在这里动态生成 -->
                </div>
            </div>
            
            <div id="characters-section" class="content-section">
                <h2>超特动作</h2>
                <div class="characters-grid" id="characters-grid">
                    <!-- 角色卡片将在这里动态生成 -->
                </div>
            </div>

            <div id="ranking-section" class="content-section">
                <h2>职业排名</h2>
                <div class="ranking-tabs">
                    <button class="ranking-tab active" data-ranking="c">
                        <i class="fas fa-user"></i>
                        <span>C排名</span>
                    </button>
                    <button class="ranking-tab" data-ranking="pf">
                        <i class="fas fa-user"></i>
                        <span>PF排名</span>
                    </button>
                    <button class="ranking-tab" data-ranking="pg">
                        <i class="fas fa-user"></i>
                        <span>PG排名</span>
                    </button>
                </div>
                <div class="ranking-content">
                    <div id="c-ranking" class="ranking-item active">
                        <img src="" alt="C排名" class="ranking-image" id="c-ranking-image" onclick="openFullscreen(this)">
                    </div>
                    <div id="pf-ranking" class="ranking-item">
                        <img src="" alt="PF排名" class="ranking-image" id="pf-ranking-image" onclick="openFullscreen(this)">
                    </div>
                    <div id="pg-ranking" class="ranking-item">
                        <img src="" alt="PG排名" class="ranking-image" id="pg-ranking-image" onclick="openFullscreen(this)">
                    </div>
                </div>
            </div>

            <!-- 超特对比区域 -->
            <div id="comparison-section" class="content-section">
                <h2>超特对比</h2>
                <div class="comparison-content">
                    <div class="comparison-grid" id="comparison-grid">
                        <!-- 对比图片将在这里动态加载 -->
                    </div>
                </div>
            </div>

            <!-- 职业&粉丝套区域 -->
            <div id="account-recommend-section" class="content-section">
                <h2>职业&粉丝套</h2>
                <div class="account-recommend-content">
                    <div class="recommend-tip">
                        <i class="fas fa-info-circle"></i>
                        <span>长按图片扫描二维码查看</span>
                    </div>
                    <div class="recommend-grid" id="recommend-grid">
                        <!-- 职业&粉丝套图片将在这里动态加载 -->
                    </div>
                </div>
            </div>

            <!-- FS单字区域 -->
            <div id="fs-single-section" class="content-section">
                <h2>FS单字</h2>
                <div class="fs-single-content">
                    <div class="fs-single-image-container">
                        <img id="fs-single-image" src="" alt="FS单字" class="fs-single-image" 
                             onerror="handleImageError(this, 'FS单字')" 
                             onload="handleImageLoad(this, 'FS单字')">
                    </div>
                </div>
            </div>

            <!-- 俱乐部区域 -->
            <div id="club-section" class="content-section">
                <h2>俱乐部</h2>
                <div class="club-content">
                    <div class="club-image-container">
                        <img id="club-image" src="" alt="俱乐部" class="club-image" 
                             onerror="handleImageError(this, '俱乐部')" 
                             onload="handleImageLoad(this, '俱乐部')">
                    </div>
                </div>
            </div>

            <!-- 最新活动区域 -->
            <div id="events-section" class="content-section">
                <h2>最新活动</h2>
                <div class="events-content">
                    <p>最新活动内容将在这里显示</p>
                </div>
            </div>

            <div id="account-section" class="content-section">
                <div class="account-container">
                    <div class="account-module">
                        <div class="module-header">
                            <i class="fas fa-store"></i>
                            <h3>查看老非FS账号店铺</h3>
                        </div>
                        <div class="module-content">
                            <p class="store-desc">点击下方进入店铺浏览FS账号，选好发给老非问价<br>老非全区代售回收账号，估价上架</p>
                            <button class="store-btn" onclick="openStore()">
                                <i class="fas fa-external-link-alt"></i>
                                <span>进入店铺</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="account-module">
                        <div class="module-header">
                            <i class="fas fa-user-check"></i>
                            <h3>老非帮选号+调试服务</h3>
                        </div>
                        <div class="module-content">
                            <p class="service-desc">专业帮您选择最适合的FS账号，并提供调试服务</p>
                            <div class="contact-info">
                                <div class="wechat-section">
                                    <label>微信号：</label>
                                    <div class="wechat-display">
                                        <span id="wechat-number">laofei90186</span>
                                        <button class="copy-btn" onclick="copyWechat()">
                                            <i class="fas fa-copy"></i>
                                            <span>复制</span>
                                        </button>
                                    </div>
                                </div>
                                <p class="copy-tip">点击复制按钮即可复制微信号，添加好友咨询详情</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="images-section" class="content-section">
                <h2>老非课程</h2>
                <div class="images-container">
                    <div class="images-grid" id="images-grid">
                        <!-- 图片将在这里动态加载 -->
                    </div>
                </div>
            </div>

            <div id="admin-section" class="content-section">
                <h2>管理端</h2>
                <p>管理端内容将在这里显示</p>
            </div>

            <div id="computer-config-section" class="content-section">
                <h2>电脑配置 仅供参考</h2>
                <div class="computer-config-container">
                    <div class="config-card">
                        <div class="config-item">
                            <div class="config-label">
                                <i class="fas fa-microchip"></i>
                                <span>处理器</span>
                            </div>
                            <div class="config-value">AMD Ryzen 7 9700X 8-Core Processor (八核)</div>
                        </div>
                        
                        <div class="config-item">
                            <div class="config-label">
                                <i class="fas fa-microchip"></i>
                                <span>主板</span>
                            </div>
                            <div class="config-value">华硕 TUF GAMING B650M-PLUS WIFI</div>
                        </div>
                        
                        <div class="config-item">
                            <div class="config-label">
                                <i class="fas fa-memory"></i>
                                <span>内存</span>
                            </div>
                            <div class="config-value">阿斯加特 32GB DDR5 6000MHz (16GB + 16GB)</div>
                        </div>
                        
                        <div class="config-item">
                            <div class="config-label">
                                <i class="fas fa-desktop"></i>
                                <span>显卡</span>
                            </div>
                            <div class="config-value">
                                <div>AMD Radeon(TM) Graphics (476MB / 华硕)</div>
                                <div>NVIDIA GeForce RTX 4060 (8GB / 微星)</div>
                            </div>
                        </div>
                        
                        <div class="config-item">
                            <div class="config-label">
                                <i class="fas fa-tv"></i>
                                <span>显示器</span>
                            </div>
                            <div class="config-value">F27G3Q [创维 SKYFFFF] (27英寸)</div>
                        </div>
                        
                        <div class="config-item">
                            <div class="config-label">
                                <i class="fas fa-hdd"></i>
                                <span>磁盘</span>
                            </div>
                            <div class="config-value">Predator SSD GM7 1TB (1024GB)</div>
                        </div>
                        
                        <div class="config-item">
                            <div class="config-label">
                                <i class="fas fa-volume-up"></i>
                                <span>声卡</span>
                            </div>
                            <div class="config-value">
                                <div>AMD High Definition Audio Device</div>
                                <div>USB Audio Device</div>
                                <div>Realtek High Definition Audio</div>
                                <div>NVIDIA High Definition Audio</div>
                            </div>
                        </div>
                        
                        <div class="config-item">
                            <div class="config-label">
                                <i class="fas fa-wifi"></i>
                                <span>网卡</span>
                            </div>
                            <div class="config-value">
                                <div>Realtek Gaming 2.5GbE Family Controller</div>
                                <div>Realtek 8852BE Wireless LAN WiFi 6 PCI-E NIC</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 全屏显示容器 -->
    <div id="fullscreen-overlay" class="fullscreen-overlay">
        <div class="fullscreen-close-btn" onclick="closeFullscreen()">
            <i class="fas fa-times"></i>
        </div>
        <img id="fullscreen-image" class="fullscreen-image" src="" alt="">
    </div>

    <!-- 分享悬浮窗 -->
    <div id="share-float" class="share-float">
        <div class="share-btn" onclick="toggleShareMenu()">
            <i class="fas fa-share-alt"></i>
        </div>
        <div id="share-menu" class="share-menu">
            <div class="share-option" onclick="shareToWeChat()">
                <i class="fab fa-weixin"></i>
                <span>微信好友</span>
            </div>
            <div class="share-option" onclick="copyLink()">
                <i class="fas fa-link"></i>
                <span>复制链接</span>
            </div>
        </div>
    </div>

    <!-- 欢迎弹窗 -->
    <div id="welcomeModal" class="welcome-modal">
        <div class="welcome-modal-content">
            <div class="welcome-header">
                <h2>欢迎使用FS资料库</h2>
            </div>
            <div class="welcome-body">
                <p>内含超特攻略- FS道具-老非教学等丰富内容，希望能够帮助你快速适应FS</p>
            </div>
            <div class="welcome-buttons">
                <button id="startExploreBtn" class="welcome-btn start-btn">
                    <i class="fas fa-rocket"></i>
                    开始探索
                </button>
                <button id="contactBtn" class="welcome-btn contact-btn">
                    <i class="fas fa-comments"></i>
                    联系老非
                </button>
            </div>
            <div class="wechat-info" id="wechatInfo" style="display: none;">
                <p>微信号：<span id="wechatNumber" class="wechat-number">laofei90186</span></p>
                <p class="copy-tip">点击微信号可复制</p>
            </div>
        </div>
    </div>

    <!-- 网站备案信息 -->
    <footer class="website-footer">
        <div class="footer-content">
            <div class="footer-info">
                <p class="footer-text">© 2025 老非FS资料库.</p>
                <p class="footer-beian">
                    <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer">
                        鲁ICP备2025184972号-1
                    </a>
                </p>
            </div>
        </div>
    </footer>

     <script src="script.js?v=202510038901"></script>
    
    <!-- 最新活动跳转函数 - 提前定义确保移动端可用 -->
    <script>
        // 提前定义最新活动跳转函数，确保移动端第一次点击就能工作
        window.openFSPLActivity = function() {
            try {
                const fsplUrl = 'https://hd.t2cn.com/t2cnevent/unmgnt/TracySignUp.shtml';
                const isMobile = /Mobile|Android|iPhone|iPad/.test(navigator.userAgent);
                const isWeChat = /MicroMessenger/i.test(navigator.userAgent);
                
                console.log('最新活动跳转 - 设备检测:', {isMobile, isWeChat});
                
                if (isMobile || isWeChat) {
                    console.log('移动端跳转到:', fsplUrl);
                    window.location.href = fsplUrl;
                } else {
                    console.log('桌面端新标签页打开:', fsplUrl);
                    window.open(fsplUrl, '_blank', 'noopener,noreferrer');
                }
            } catch (error) {
                console.error('最新活动跳转失败:', error);
                window.location.href = 'https://hd.t2cn.com/t2cnevent/unmgnt/TracySignUp.shtml';
            }
        };
    </script>

    <!-- 智能设备检测和兼容性优化 -->
    <script>
        // 智能设备检测和兼容性优化
        (function() {
            // 全面的设备检测
            var isWeChat = /MicroMessenger/i.test(navigator.userAgent);
            var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            var isAndroid = /Android/.test(navigator.userAgent);
            var isMobile = /Mobile|Android|iPhone|iPad/.test(navigator.userAgent);
            var isDesktop = !isMobile;
            var isNewUser = !localStorage.getItem('hasVisited');
            
            // 设备信息记录
            var deviceInfo = {
                isWeChat: isWeChat,
                isIOS: isIOS,
                isAndroid: isAndroid,
                isMobile: isMobile,
                isDesktop: isDesktop,
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                screenWidth: window.screen.width,
                screenHeight: window.screen.height,
                viewportWidth: window.innerWidth,
                viewportHeight: window.innerHeight,
                pixelRatio: window.devicePixelRatio || 1
            };
            
            console.log('设备检测结果:', deviceInfo);
            
            // 根据设备类型应用不同的优化策略
            function applyDeviceOptimizations() {
                if (isWeChat) {
                    console.log('应用微信浏览器优化');
                    applyWeChatOptimizations();
                } else if (isIOS) {
                    console.log('应用iOS设备优化');
                    applyIOSOptimizations();
                } else if (isAndroid) {
                    console.log('应用Android设备优化');
                    applyAndroidOptimizations();
                } else if (isDesktop) {
                    console.log('应用桌面端优化');
                    applyDesktopOptimizations();
                }
                
                // 应用通用优化
                applyCommonOptimizations();
            }
            
            // 微信浏览器特殊优化
            function applyWeChatOptimizations() {
                // 微信JS-SDK准备
                document.addEventListener('WeixinJSBridgeReady', function() {
                    console.log('微信JS-SDK准备就绪');
                    if (typeof WeixinJSBridge !== 'undefined') {
                        WeixinJSBridge.call('hideOptionMenu');
                        WeixinJSBridge.call('showOptionMenu');
                    }
                });
                
                // 微信浏览器特殊样式
                document.body.classList.add('wechat-browser');
                
                // 新用户特殊处理
                if (isNewUser) {
                    console.log('微信新用户特殊处理');
                    setTimeout(function() {
                        initializePageFunctions();
                    }, 2000);
                }
            }
            
            // iOS设备特殊优化
            function applyIOSOptimizations() {
                // iOS特殊样式
                document.body.classList.add('ios-device');
                document.body.style.webkitOverflowScrolling = 'touch';
                
                // iOS图片加载优化
                var images = document.querySelectorAll('img');
                for (var i = 0; i < images.length; i++) {
                    images[i].style.webkitUserSelect = 'none';
                    images[i].style.webkitTouchCallout = 'none';
                }
                
                // iOS错误处理
                window.addEventListener('error', function(e) {
                    console.error('iOS错误:', e.error);
                });
            }
            
            // Android设备特殊优化
            function applyAndroidOptimizations() {
                // Android特殊样式
                document.body.classList.add('android-device');
                
                // Android触摸优化
                document.addEventListener('touchstart', function() {}, {passive: true});
                document.addEventListener('touchmove', function() {}, {passive: true});
            }
            
            // 桌面端优化
            function applyDesktopOptimizations() {
                // 桌面端特殊样式
                document.body.classList.add('desktop-device');
                
                // 桌面端功能增强
                enableDesktopFeatures();
            }
            
            // 通用优化
            function applyCommonOptimizations() {
                // 响应式布局优化
                var viewport = document.querySelector('meta[name="viewport"]');
                if (viewport) {
                    if (isMobile) {
                        viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover');
                    } else {
                        viewport.setAttribute('content', 'width=device-width, initial-scale=1.0');
                    }
                }
                
                // 性能优化
                if (isMobile) {
                    // 移动端性能优化
                    document.body.style.willChange = 'auto';
                    document.body.style.transform = 'translateZ(0)';
                }
            }
            
            // 桌面端功能增强
            function enableDesktopFeatures() {
                // 键盘快捷键
                document.addEventListener('keydown', function(e) {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key) {
                            case 'r':
                                e.preventDefault();
                                window.location.reload();
                                break;
                            case 'f':
                                e.preventDefault();
                                // 可以添加搜索功能
                                break;
                        }
                    }
                });
            }
            
            // 安全的调试信息函数
            function safeDebugInfo(message) {
                try {
                    if (typeof addDebugInfo === 'function') {
                        addDebugInfo(message);
                    } else {
                        console.log('Debug:', message);
                    }
                } catch (e) {
                    console.log('Debug:', message);
                }
            }
            
            console.log('浏览器检测:', '微信:', isWeChat, 'iOS:', isIOS, '新用户:', isNewUser);
            safeDebugInfo('浏览器检测: 微信=' + isWeChat + ', iOS=' + isIOS + ', 新用户=' + isNewUser);
            
            // 标记用户已访问
            if (isNewUser) {
                localStorage.setItem('hasVisited', 'true');
                safeDebugInfo('新用户首次访问');
            }
            
            // 强制清除缓存 - 更激进的方法
            function forceClearCache() {
                // 新用户不清除缓存，避免影响首次加载
                if (isNewUser) {
                    safeDebugInfo('新用户，跳过缓存清除');
                    return;
                }
                
                // 清除localStorage和sessionStorage
                localStorage.clear();
                sessionStorage.clear();
                safeDebugInfo('localStorage和sessionStorage已清除');
                
                // 清除所有缓存
                if ('caches' in window) {
                    caches.keys().then(function(names) {
                        for (var i = 0; i < names.length; i++) {
                            caches.delete(names[i]);
                            console.log('缓存已清除:', names[i]);
                            safeDebugInfo('缓存已清除: ' + names[i]);
                        }
                    });
                }
                
                // 强制刷新页面（仅在必要时）
                var lastVisit = localStorage.getItem('lastVisit');
                var currentTime = new Date().getTime();
                if (!lastVisit || (currentTime - parseInt(lastVisit)) > 300000) { // 5分钟
                    localStorage.setItem('lastVisit', currentTime);
                    safeDebugInfo('页面可能需要强制刷新');
                }
            }
            
            // Service Worker状态检查
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    console.log('当前Service Worker数量:', registrations.length);
                    safeDebugInfo('当前Service Worker数量: ' + registrations.length);
                    for (var i = 0; i < registrations.length; i++) {
                        console.log('Service Worker状态:', registrations[i].active ? 'active' : 'inactive');
                        safeDebugInfo('Service Worker状态: ' + (registrations[i].active ? 'active' : 'inactive'));
                    }
                });
            }
            
            // 执行强制清除缓存
            forceClearCache();
            
            // 预加载关键资源
            function preloadResources() {
                safeDebugInfo('开始预加载关键资源');
                
                // 预加载CSS
                var cssLink = document.createElement('link');
                cssLink.rel = 'preload';
                cssLink.as = 'style';
                 cssLink.href = 'styles.css?v=202510038901';
                document.head.appendChild(cssLink);
                
                // 预加载JS
                var jsLink = document.createElement('link');
                jsLink.rel = 'preload';
                jsLink.as = 'script';
                 jsLink.href = 'script.js?v=202510038901';
                document.head.appendChild(jsLink);
                
                // 预加载关键图片（使用CDN域名，避免直连COS产生流量费用）
                var imageUrls = [
                    'https://cdn.laofeifs.com/gallery/超特图鉴.png',
                    'https://cdn.laofeifs.com/ranking/C排名.png'
                ];
                
                for (var i = 0; i < imageUrls.length; i++) {
                    var img = new Image();
                    img.src = imageUrls[i] + '?v=202510037800';
                    img.onload = function() {
                        safeDebugInfo('图片预加载成功: ' + this.src);
                    };
                    img.onerror = function() {
                        safeDebugInfo('图片预加载失败: ' + this.src);
                    };
                }
                
                safeDebugInfo('预加载资源设置完成');
            }
            
            // 新用户执行预加载
            if (isNewUser) {
                preloadResources();
            }
            
            // 确保预加载的资源版本与当前版本一致
            setTimeout(function() {
                var currentVersion = '202510038901';
                var cssLinks = document.querySelectorAll('link[rel="preload"][as="style"]');
                var jsLinks = document.querySelectorAll('link[rel="preload"][as="script"]');
                
                cssLinks.forEach(function(link) {
                    if (link.href.includes('styles.css')) {
                        link.href = 'styles.css?v=' + currentVersion;
                    }
                });
                
                jsLinks.forEach(function(link) {
                    if (link.href.includes('script.js')) {
                        link.href = 'script.js?v=' + currentVersion;
                    }
                });
            }, 100);
            
            // HTTPS强制检查（仅对网络访问生效）
            if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.protocol !== 'file:') {
                safeDebugInfo('检测到非HTTPS协议，重定向到HTTPS');
                location.replace('https:' + location.href.substring(location.protocol.length));
                return;
            }
            
            // CORS检查
            function checkCORS() {
                var testImage = new Image();
                testImage.onload = function() {
                    safeDebugInfo('CORS检查通过 - 图片加载正常');
                };
                testImage.onerror = function() {
                    safeDebugInfo('CORS检查失败 - 图片加载失败');
                    // 移除微信警告提示
                };
                testImage.src = 'https://cdn.laofeifs.com/gallery/超特图鉴.png?v=202510037800';
            }
            
            if (isWeChat) {
                console.log('微信浏览器检测到，应用特殊处理');
                safeDebugInfo('微信浏览器检测到，应用特殊处理');
                
                // 新用户特殊处理
                if (isNewUser) {
                    safeDebugInfo('新用户微信浏览器特殊处理');
                    // 延迟初始化，确保页面完全加载
                    setTimeout(function() {
                        initializePageFunctions();
                    }, 2000);
                }
                
                // 页面功能初始化函数
                function initializePageFunctions() {
                    var success = true;
                    
                    if (typeof initializeNavigation === 'function') {
                        try {
                            initializeNavigation();
                            safeDebugInfo('导航初始化完成');
                        } catch (e) {
                            safeDebugInfo('导航初始化失败: ' + e.message);
                            success = false;
                        }
                    }
                    
                    if (typeof initializeFilters === 'function') {
                        try {
                            initializeFilters();
                            safeDebugInfo('筛选器初始化完成');
                        } catch (e) {
                            safeDebugInfo('筛选器初始化失败: ' + e.message);
                            success = false;
                        }
                    }
                    
                    if (typeof loadCharacters === 'function') {
                        try {
                            loadCharacters('9');
                            safeDebugInfo('角色加载完成');
                        } catch (e) {
                            safeDebugInfo('角色加载失败: ' + e.message);
                            success = false;
                        }
                    }
                    
                    if (!success) {
                        safeDebugInfo('部分功能初始化失败，3秒后重试');
                        setTimeout(function() {
                            initializePageFunctions();
                        }, 3000);
                    }
                }
                
                // 执行CORS检查
                setTimeout(function() {
                    checkCORS();
                }, 1000);
                
                // iOS微信特殊处理
                if (isIOS) {
                    console.log('iOS微信特殊处理');
                    safeDebugInfo('iOS微信特殊处理');
                    document.body.style.webkitOverflowScrolling = 'touch';
                    // 移除固定定位，保持正常滚动
                }
                
                // 微信JS-SDK准备
                document.addEventListener('WeixinJSBridgeReady', function() {
                    console.log('微信JS-SDK准备就绪');
                    safeDebugInfo('微信JS-SDK准备就绪');
                    if (typeof WeixinJSBridge !== 'undefined') {
                        WeixinJSBridge.call('hideOptionMenu');
                        WeixinJSBridge.call('showOptionMenu');
                    }
                });
                
                // 延迟初始化
                setTimeout(function() {
                    console.log('微信浏览器延迟初始化');
                    safeDebugInfo('微信浏览器延迟初始化');
                    if (typeof initializeNavigation === 'function') {
                        initializeNavigation();
                        safeDebugInfo('导航初始化完成');
                    }
                    if (typeof initializeFilters === 'function') {
                        initializeFilters();
                        safeDebugInfo('筛选器初始化完成');
                    }
                    if (typeof loadCharacters === 'function') {
                        loadCharacters('9');
                        safeDebugInfo('角色加载完成');
                    }
                }, 1000);
            }
            
            // 页面加载完成后的处理
            window.addEventListener('load', function() {
                console.log('页面加载完成');
                safeDebugInfo('页面完全加载完成');
                
                // 新用户特殊处理
                if (isNewUser) {
                    safeDebugInfo('新用户页面加载完成，等待初始化');
                    // 新用户给更多时间加载
                    setTimeout(function() {
                        checkPageContent();
                    }, 4000);
                } else {
                    // 老用户正常检查
                    setTimeout(function() {
                        checkPageContent();
                    }, 3000);
                }
            });
            
            // 检查页面内容函数
            function checkPageContent() {
                var contentSections = document.querySelectorAll('.content-section');
                var hasContent = false;
                var retryCount = parseInt(localStorage.getItem('retryCount') || '0');
                
                for (var i = 0; i < contentSections.length; i++) {
                    if (contentSections[i].children.length > 1) {
                        hasContent = true;
                        break;
                    }
                }
                
                if (!hasContent) {
                    safeDebugInfo('页面内容加载失败，重试次数: ' + retryCount);
                    
                    // 限制重试次数，避免无限循环
                    if (retryCount < 3) {
                        retryCount++;
                        localStorage.setItem('retryCount', retryCount.toString());
                        safeDebugInfo('准备第' + retryCount + '次重试');
                        
                        // 延迟重试
                        setTimeout(function() {
                            safeDebugInfo('执行第' + retryCount + '次重试');
                            initializePageFunctions();
                            checkPageContent();
                        }, 2000);
                    } else {
                        safeDebugInfo('重试次数已达上限，建议手动刷新');
                        // 重置重试计数
                        localStorage.removeItem('retryCount');
                    }
                } else {
                    safeDebugInfo('页面内容加载正常');
                    // 重置重试计数
                    localStorage.removeItem('retryCount');
                    
                    if (isWeChat) {
                        setTimeout(function() {
                            console.log('内容区域数量:', contentSections.length);
                            safeDebugInfo('内容区域数量: ' + contentSections.length);
                            for (var i = 0; i < contentSections.length; i++) {
                                console.log('区域', i, ':', contentSections[i].id, '显示状态:', contentSections[i].style.display);
                                safeDebugInfo('区域' + i + ': ' + contentSections[i].id + ' 显示状态: ' + contentSections[i].style.display);
                            }
                        }, 2000);
                    }
                }
            }
        })();
        
        // 调试功能
        function addDebugInfo(message) {
            var debugContent = document.getElementById('debug-content');
            if (debugContent) {
                var time = new Date().toLocaleTimeString();
                debugContent.innerHTML += '<div>[' + time + '] ' + message + '</div>';
                console.log('[' + time + '] ' + message);
            }
        }
        
        function toggleDebug() {
            var debugInfo = document.getElementById('debug-info');
            if (debugInfo.style.display === 'none') {
                debugInfo.style.display = 'block';
            } else {
                debugInfo.style.display = 'none';
            }
        }
        

        
        function forceRefresh() {
            if (typeof addDebugInfo === 'function') {
                addDebugInfo('执行强制刷新');
            }
            // 清除所有缓存
            localStorage.clear();
            sessionStorage.clear();
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    for (var i = 0; i < names.length; i++) {
                        caches.delete(names[i]);
                        if (typeof addDebugInfo === 'function') {
                            addDebugInfo('清除缓存: ' + names[i]);
                        }
                    }
                });
            }
            
            // 通知Service Worker清除缓存
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({
                    type: 'CLEAR_CACHE'
                });
                if (typeof addDebugInfo === 'function') {
                    addDebugInfo('通知Service Worker清除缓存');
                }
            }
            
            // 强制刷新页面
            window.location.reload(true);
        }
        
        // 缓存管理功能
        function clearAllCaches() {
            if (typeof addDebugInfo === 'function') {
                addDebugInfo('清除所有缓存');
            }
            return new Promise(function(resolve) {
                // 清除localStorage和sessionStorage
                localStorage.clear();
                sessionStorage.clear();
                
                // 清除Service Worker缓存
                if ('caches' in window) {
                    caches.keys().then(function(names) {
                        var promises = names.map(function(name) {
                            return caches.delete(name);
                        });
                        Promise.all(promises).then(function() {
                            if (typeof addDebugInfo === 'function') {
                                addDebugInfo('所有缓存已清除');
                            }
                            resolve();
                        });
                    });
                } else {
                    resolve();
                }
            });
        }
        
        // 检查缓存状态
        function checkCacheStatus() {
            if (typeof addDebugInfo === 'function') {
                addDebugInfo('检查缓存状态');
            }
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    if (typeof addDebugInfo === 'function') {
                        addDebugInfo('当前缓存数量: ' + names.length);
                    }
                    for (var i = 0; i < names.length; i++) {
                        if (typeof addDebugInfo === 'function') {
                            addDebugInfo('缓存: ' + names[i]);
                        }
                        caches.open(names[i]).then(function(cache) {
                            cache.keys().then(function(requests) {
                                if (typeof addDebugInfo === 'function') {
                                    addDebugInfo('缓存内容数量: ' + requests.length);
                                }
                            });
                        });
                    }
                });
            }
            
            // 检查Service Worker状态
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    if (typeof addDebugInfo === 'function') {
                        addDebugInfo('Service Worker数量: ' + registrations.length);
                    }
                    for (var i = 0; i < registrations.length; i++) {
                        if (typeof addDebugInfo === 'function') {
                            addDebugInfo('SW状态: ' + (registrations[i].active ? 'active' : 'inactive'));
                        }
                    }
                });
            }
        }
    </script>
</body>
</html>
