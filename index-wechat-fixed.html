<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>老非FS资料库</title>
    
    <!-- 微信浏览器强制刷新 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Last-Modified" content="0">
    
    <!-- 微信浏览器优化 -->
    <meta name="format-detection" content="telephone=no, email=no, address=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- 微信分享优化 -->
    <meta property="og:title" content="老非FS资料库">
    <meta property="og:description" content="街头篮球超特角色图鉴">
    <meta property="og:image" content="https://laofei-1259209256.cos.ap-nanjing.myqcloud.com/gallery/超特图鉴.png">
    <meta property="og:url" content="https://laofeifs.github.io/FSlaofeiziliaoku/">
    
    <!-- 安全策略 - 微信优化 -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https: data: blob:; img-src 'self' https: data: blob: *; connect-src 'self' https: *;">
    
    <!-- 外部资源 - 微信优化 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- 样式文件 - 强制刷新 -->
    <link rel="stylesheet" href="styles.css?v=202508292305">
    
    <style>
        /* 微信浏览器特殊样式 */
        body {
            -webkit-overflow-scrolling: touch;
            overflow-x: hidden;
        }
        
        /* 防止微信浏览器缩放 */
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* 微信浏览器加载提示 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 16px;
            color: #333;
            text-align: center;
        }
        
        .error-message {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            text-align: center;
            display: none;
        }
        
        .retry-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- 加载提示 -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">正在加载...</div>
    </div>
    
    <!-- 错误提示 -->
    <div id="error-message" class="error-message">
        <p>页面加载失败，请点击下方按钮重试</p>
        <button class="retry-btn" onclick="retryLoad()">重新加载</button>
    </div>
    
    <!-- 头部区域 -->
    <div class="header">
        <h1 class="main-title">街头篮球资料库</h1>
        <p class="subtitle">老非FS资料库 - 超特角色图鉴</p>
        <div class="header-bottom">
            <span class="powered-by">Powered by 老非</span>
            <span class="powered-by">laofei90186</span>
        </div>
        
        <!-- 微信刷新提示 -->
        <div class="refresh-tip-header">
            <i class="fas fa-exclamation-triangle"></i>
            <span>点击右上角三个点➡️刷新获取最新版</span>
        </div>
        
        <!-- 导航按钮 -->
        <div class="nav-buttons">
            <button class="nav-btn active" data-section="gallery">
                <i class="fas fa-images"></i>
                <span>超特图鉴</span>
            </button>
            <button class="nav-btn" data-section="characters">
                <i class="fas fa-running"></i>
                <span>超特动作</span>
            </button>
            <button class="nav-btn" data-section="ranking">
                <i class="fas fa-trophy"></i>
                <span>职业排名</span>
            </button>
            <button class="nav-btn" data-section="account">
                <i class="fas fa-user-circle"></i>
                <span>FS账号</span>
            </button>
            <button class="nav-btn" data-section="courses">
                <i class="fas fa-graduation-cap"></i>
                <span>老非课程</span>
            </button>
        </div>
    </div>
    
    <!-- 主要内容区域 -->
    <div class="content">
        <!-- 筛选按钮容器 -->
        <div class="filter-container">
            <button class="filter-btn active" data-generation="9">9代</button>
            <button class="filter-btn" data-generation="8">8代</button>
            <button class="filter-btn" data-generation="7">7代</button>
            <button class="filter-btn" data-generation="6">6代</button>
            <button class="filter-btn" data-generation="5">5代</button>
            <button class="filter-btn" data-generation="4_5">4.5代</button>
            <button class="filter-btn" data-generation="4">4代</button>
            <button class="filter-btn" data-generation="3_5">3.5代</button>
            <button class="filter-btn" data-generation="3">3代</button>
            <button class="filter-btn" data-generation="2">2代</button>
            <button class="filter-btn" data-generation="1">1代</button>
        </div>
        
        <!-- 超特图鉴 -->
        <div id="gallery-section" class="content-section active">
            <h2 class="section-title">超特图鉴</h2>
            <div id="gallery-grid">
                <!-- 图鉴内容将通过JavaScript动态生成 -->
            </div>
        </div>
        
        <!-- 超特动作 -->
        <div id="characters-section" class="content-section">
            <h2 class="section-title">超特动作</h2>
            <div id="characters-grid">
                <!-- 角色卡片将通过JavaScript动态生成 -->
            </div>
        </div>
        
        <!-- 职业排名 -->
        <div id="ranking-section" class="content-section">
            <h2 class="section-title">职业排名</h2>
            <div class="ranking-tabs">
                <button class="ranking-tab active" data-ranking="c">C排名</button>
                <button class="ranking-tab" data-ranking="pf">PF排名</button>
                <button class="ranking-tab" data-ranking="pg">PG排名</button>
            </div>
            <div class="ranking-content">
                <div id="c-ranking" class="ranking-item active">
                    <img id="c-ranking-image" class="ranking-image" alt="C排名" style="max-width: 100%; height: auto;">
                </div>
                <div id="pf-ranking" class="ranking-item">
                    <img id="pf-ranking-image" class="ranking-image" alt="PF排名" style="max-width: 100%; height: auto;">
                </div>
                <div id="pg-ranking" class="ranking-item">
                    <img id="pg-ranking-image" class="ranking-image" alt="PG排名" style="max-width: 100%; height: auto;">
                </div>
            </div>
        </div>
        
        <!-- FS账号 -->
        <div id="account-section" class="content-section">
            <div class="account-container">
                <div class="account-module">
                    <div class="module-header">
                        <i class="fas fa-store"></i>
                        <h3>查看老非FS账号店铺</h3>
                    </div>
                    <div class="module-content">
                        <p class="store-desc">进入老非的微店查看账号</p>
                        <button class="store-btn" onclick="openStore()">进入店铺</button>
                    </div>
                </div>
                <div class="account-module">
                    <div class="module-header">
                        <i class="fas fa-user-cog"></i>
                        <h3>老非帮选号+调试服务</h3>
                    </div>
                    <div class="module-content">
                        <p class="service-desc">专业选号调试服务</p>
                        <div class="contact-info">
                            <div class="wechat-section">
                                <label>微信号:</label>
                                <div class="wechat-display">
                                    <span id="wechat-number">laofei90186</span>
                                    <button class="copy-btn" onclick="copyWechat()">复制</button>
                                </div>
                            </div>
                            <div class="copy-tip" id="copy-tip" style="display: none;">微信号已复制到剪贴板</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 老非课程 -->
        <div id="courses-section" class="content-section">
            <h2 class="section-title">老非课程</h2>
            <div class="courses-container">
                <div class="course-category">
                    <h3>适合内线的课程</h3>
                    <div class="course-grid">
                        <div class="course-card" onclick="openCourse('https://course1.example.com')">
                            <div class="course-banner">
                                <div class="course-banner-content">
                                    <div class="course-banner-title">内线基础</div>
                                </div>
                            </div>
                            <div class="course-info">
                                <h4 class="course-title">内线基础技能训练</h4>
                                <p class="course-desc">适合新手内线玩家，从基础开始学习</p>
                                <span class="course-tag">基础</span>
                            </div>
                        </div>
                        <div class="course-card" onclick="openCourse('https://course2.example.com')">
                            <div class="course-banner">
                                <div class="course-banner-content">
                                    <div class="course-banner-title">内线进阶</div>
                                </div>
                            </div>
                            <div class="course-info">
                                <h4 class="course-title">内线进阶技巧</h4>
                                <p class="course-desc">提升内线技能，掌握高级技巧</p>
                                <span class="course-tag">进阶</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="course-category">
                    <h3>适合PG的课程</h3>
                    <div class="course-grid">
                        <div class="course-card" onclick="openCourse('https://course3.example.com')">
                            <div class="course-banner">
                                <div class="course-banner-content">
                                    <div class="course-banner-title">PG基础</div>
                                </div>
                            </div>
                            <div class="course-info">
                                <h4 class="course-title">PG基础技能训练</h4>
                                <p class="course-desc">适合新手PG玩家，从基础开始学习</p>
                                <span class="course-tag">基础</span>
                            </div>
                        </div>
                        <div class="course-card" onclick="openCourse('https://course4.example.com')">
                            <div class="course-banner">
                                <div class="course-banner-content">
                                    <div class="course-banner-title">PG进阶</div>
                                </div>
                            </div>
                            <div class="course-info">
                                <h4 class="course-title">PG进阶技巧</h4>
                                <p class="course-desc">提升PG技能，掌握高级技巧</p>
                                <span class="course-tag">进阶</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 全屏图片显示 -->
    <div class="fullscreen-overlay" id="fullscreen-overlay" style="display: none;">
        <img class="fullscreen-image" id="fullscreen-image" alt="全屏显示">
    </div>
    
    <!-- JavaScript文件 - 强制刷新 -->
    <script src="script.js?v=202508292305"></script>
    
    <!-- 微信浏览器特殊处理脚本 -->
    <script>
        // 微信浏览器特殊处理
        (function() {
            var isWeChat = /MicroMessenger/i.test(navigator.userAgent);
            var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            var loadTimeout = null;
            var retryCount = 0;
            var maxRetries = 3;
            
            console.log('微信浏览器检测:', isWeChat, 'iOS:', isIOS);
            
            // 强制清除微信浏览器缓存
            function clearWeChatCache() {
                if (isWeChat) {
                    console.log('清除微信浏览器缓存');
                    localStorage.clear();
                    sessionStorage.clear();
                    
                    // 强制刷新CSS和JS
                    var links = document.querySelectorAll('link[rel="stylesheet"]');
                    for (var i = 0; i < links.length; i++) {
                        var link = links[i];
                        link.href = link.href + (link.href.indexOf('?') > -1 ? '&' : '?') + 'v=' + new Date().getTime();
                    }
                }
            }
            
            // 显示加载提示
            function showLoading() {
                document.getElementById('loading-overlay').style.display = 'flex';
                document.getElementById('error-message').style.display = 'none';
            }
            
            // 隐藏加载提示
            function hideLoading() {
                document.getElementById('loading-overlay').style.display = 'none';
            }
            
            // 显示错误信息
            function showError() {
                document.getElementById('loading-overlay').style.display = 'none';
                document.getElementById('error-message').style.display = 'block';
            }
            
            // 重试加载
            function retryLoad() {
                retryCount++;
                if (retryCount <= maxRetries) {
                    console.log('重试加载，第', retryCount, '次');
                    showLoading();
                    clearWeChatCache();
                    setTimeout(function() {
                        location.reload(true);
                    }, 1000);
                } else {
                    alert('页面加载失败，请手动刷新页面');
                }
            }
            
            // 检查页面是否正常加载
            function checkPageLoad() {
                var contentSections = document.querySelectorAll('.content-section');
                var hasContent = false;
                
                for (var i = 0; i < contentSections.length; i++) {
                    if (contentSections[i].children.length > 1) {
                        hasContent = true;
                        break;
                    }
                }
                
                if (hasContent) {
                    console.log('页面内容加载成功');
                    hideLoading();
                } else {
                    console.log('页面内容加载失败');
                    if (retryCount < maxRetries) {
                        setTimeout(function() {
                            retryLoad();
                        }, 2000);
                    } else {
                        showError();
                    }
                }
            }
            
            // 微信浏览器特殊初始化
            if (isWeChat) {
                console.log('微信浏览器特殊处理');
                
                // 强制清除缓存
                clearWeChatCache();
                
                // 设置加载超时
                loadTimeout = setTimeout(function() {
                    console.log('加载超时');
                    checkPageLoad();
                }, 10000); // 10秒超时
                
                // 微信JS-SDK准备
                document.addEventListener('WeixinJSBridgeReady', function() {
                    console.log('微信JS-SDK准备就绪');
                    
                    if (typeof WeixinJSBridge !== 'undefined') {
                        WeixinJSBridge.call('hideOptionMenu');
                        WeixinJSBridge.call('showOptionMenu');
                    }
                });
                
                // iOS微信特殊处理
                if (isIOS) {
                    console.log('iOS微信特殊处理');
                    
                    // 防止iOS微信的弹性滚动
                    document.body.style.webkitOverflowScrolling = 'touch';
                    document.body.style.overflow = 'hidden';
                    document.body.style.position = 'fixed';
                    document.body.style.width = '100%';
                    document.body.style.height = '100%';
                }
            }
            
            // 页面加载完成后的处理
            window.addEventListener('load', function() {
                console.log('页面加载完成');
                
                if (loadTimeout) {
                    clearTimeout(loadTimeout);
                }
                
                if (isWeChat) {
                    // 微信浏览器延迟检查
                    setTimeout(function() {
                        checkPageLoad();
                    }, 2000);
                } else {
                    // 非微信浏览器直接隐藏加载提示
                    hideLoading();
                }
            });
            
            // 错误处理
            window.addEventListener('error', function(e) {
                console.error('页面错误:', e.error);
                
                if (isWeChat && retryCount < maxRetries) {
                    setTimeout(function() {
                        retryLoad();
                    }, 1000);
                }
            });
            
            // 暴露重试函数给全局
            window.retryLoad = retryLoad;
        })();
    </script>
</body>
</html>
